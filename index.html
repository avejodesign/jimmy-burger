<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Cardápio | Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* PALETA CLARA */
      --bg:#ffffff;
      --card:#ffffff;
      --muted:#5b6475;          /* cinza de texto secundário */
      --text:#111317;           /* texto principal (quase preto) */
      --brand:#fff04d;          /* amarelo mais suave */
      --brand-600:#F2C200;      /* hover do amarelo */
      --danger:#ff5a60;
      --border:#e5e7eb;         /* borda clara */
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      background:var(--bg);
      color:var(--text);

      /* background: black; */
    }

    /* HEADER CLARO */
    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter:saturate(120%) blur(8px);
      background:rgba(0, 0, 0, 1);
      border-bottom:1px solid var(--border);
    }

    #cat-burgers { margin: 0; }

    .wrap{ margin:0 auto; padding:4px 20px; background: black;}
    .brand{
      display:flex; align-items:center; gap:12px; justify-content: center;
      background: black;
    }
    .brand img{ width:50%;}
    .brand h1{margin:0; font-size:20px; letter-spacing:.2px}
    .tag{font-size:12px; color:var(--muted); background:#f6f7f9; padding:4px 8px; border:1px solid var(--border); border-radius:999px}

    /* NAV CATEGORIES CLARO */
    .nav{ margin-left: 20px; display:flex; gap:6px; overflow-x:auto; padding:10px 20px 16px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch }
    .nav a{
      scroll-snap-align:start; white-space:nowrap; text-decoration:none; color: rgb(0, 0, 0);
      border:1px solid #3c3c3c; padding:4px 14px; border-radius:999px; background:#ffffff; font-size:14px; opacity:.95
    }
    .nav a.active{ background:var(--brand); border-color:transparent; color:#111; font-weight:600 }

    main{ max-width:1200px; margin:0 auto; padding:20px; padding-bottom:140px; background:var(--bg) }

    section.duvidas {
      background:rgb(0, 0, 0, 1);
      position: fixed;
      left: 0;
      bottom: 0;
      padding:4px 10px; text-align:center;
      width: 100%;
      color: white;
      display: flex;
      justify-content: center;
    }

    section.duvidas p { font-size: 12px; margin-right: 4px; }
    section.duvidas a {
      background: #00E01A; color: black; padding: 2px 8px;
      display: flex; align-items: center; justify-content: center;
      border-radius: 999px; text-decoration: none; font-size: 14px; font-weight: 600;
    }

    .section{ margin:26px 0 8px }
    .section h2{ font-size:22px; margin:0 0 14px; font-weight:600 }

    .grid{ display:grid; gap:16px; grid-template-columns:repeat(1, minmax(0,1fr)) }
    @media (min-width:560px){ .grid{ grid-template-columns:repeat(2, minmax(0,1fr)) } }
    @media (min-width:920px){ .grid{ grid-template-columns:repeat(3, minmax(0,1fr)) } }

    .card{
      background:var(--card);
      border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow);
      display:flex; flex-direction:column; justify-content: space-between; cursor:pointer;
    }
    .thumb{ aspect-ratio:16/10; width:100%; object-fit:cover; }
    .info{ padding:14px 14px 12px; display:flex; flex-direction:column; gap:10px; width: 100%;}
    .title{ font-size:16px; margin:0; letter-spacing:.2px; color:var(--text) }
    .desc{ font-size:13px; color:var(--muted); margin:0 }
    .priceRow{ display:flex; align-items:center; justify-content:space-between }
    .price{ font-weight:600 }

    .btn{ appearance:none; cursor:pointer; border:1px solid transparent; border-radius:12px; padding:10px 12px; font-weight:600; font-size:14px; }
    .btn-primary{ background:var(--brand); color:#111; border-color:transparent }
    .btn-primary:hover{ background:var(--brand-600) }
    .btn-ghost{ background:#fff; color:#111; border-color:var(--border) }
    .btn-ghost:hover{ background:#f8f9fb }

    /* CART CLARO */
    .cart{
      position:fixed; right:20px; top:80px; width:340px; max-height:70vh; overflow:scroll; z-index:50;
      background:#ffffff;
      border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow);
      color:var(--text);
    }
    .cart header{ position:sticky; top:0; background:rgba(255,255,255,.9); backdrop-filter:saturate(120%) blur(6px); border-bottom:1px solid var(--border) }
    .cartHead{ display:flex; align-items:center; justify-content:space-between; padding:14px 14px 6px }
    .cartBody{ padding:8px 14px 14px; display:flex; flex-direction:column; gap:10px }
    .line{ display:flex; align-items:center; gap:10px; justify-content:space-between; border:1px dashed var(--border); border-radius:12px; padding:10px; background:#fff }
    .lineTitle{ font-size:13px }
    .qty{ display:flex; align-items:center; gap:8px }
    .chip{ border:1px solid var(--border); background:#f9fafb; padding:4px 8px; border-radius:999px; font-size:12px; color:#374151 }
    .iconBtn{ width:28px; height:28px; border-radius:8px; border:1px solid var(--border); background:#ffffff; color:#111; cursor:pointer; font-weight:700 }
    .iconBtn:hover{ background:#f6f7f9 }
    .totals{font-size:14px; display:grid; gap:6px }
    .totals div{ display:flex; align-items:center; justify-content:space-between }
    .inputs{ display:grid; gap:8px; margin-top:6px }
    .field{ display:grid; gap:6px }
    .field label{ font-size:12px; color:var(--muted) }
    .field input, .field textarea, .field select{ width:100%; background:#fff; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px; font-family:inherit; font-size:14px }

    .actions{ display:grid; gap:8px; margin-top:8px }
    .tiny{ font-size:12px; color:var(--muted) }

    /* MOBILE CART */
    .cartToggle{
      position:fixed; left:50%; transform:translateX(-50%);
      bottom:16px; z-index:60; padding:20px 24px; background:var(--brand); color:#111; border:none; border-radius:999px; font-weight:700; box-shadow:var(--shadow); display:none
    }
    @media (max-width:1024px){
      .cart{ left:16px; right:16px; bottom:20px; top:10px; width:auto; max-height: 100vh; height: calc(100vh - 40px); }
      .cartToggle{ display:inline-flex }
    }

    /* Smooth scroll */
    html{ scroll-behavior:smooth }
    .empty{ text-align:center; color:var(--muted); border:1px dashed var(--border); padding:16px; border-radius:12px }

    /* Lista mobile com thumb à direita */
    .points{display:none; align-items:center; gap:6px; font-size:12px; color:var(--brand)}
    .points .gift{width:16px; height:16px; fill:var(--brand)}
    @media (max-width:560px){
      .card{ flex-direction:row-reverse; align-items:center }
      .thumb{ width:88px; height:88px; aspect-ratio:1/1; border-radius:12px; margin:12px; object-fit:cover }
      .info{ padding:12px; gap:6px }
      .title{ font-size:14px; text-transform:uppercase; letter-spacing:.2px }
      .desc{ font-size:11px; text-transform:uppercase; color:var(--muted); line-height:1.25 }
      .priceRow{ margin-top:2px }
      .points{ display:flex }
    }

    /* MODAL (fluxo estilo iFood) */
    .modal{ position:fixed; inset:0; display:none; z-index:80; }
    .modal.is-open{ display:block }
    .modal .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.5); }
    .modal .sheet{ position:absolute; right:0; top:0; bottom:0; width:560px; max-width:100%; background:#fff; color:#111; border-left:1px solid var(--border); box-shadow:var(--shadow); display:flex; flex-direction:column }
    .sheet header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border) }
    .sheet h3{ margin:0; font-size:18px;}
    .sheet header strong {
        color: white;
    }
    .sheet .body{ padding:12px 14px; overflow:auto; display:grid; gap:12px }
    .sheet .prodHead{ display:flex; gap:12px; align-items:center }
    .sheet .prodHead img{ width:84px; height:84px; border-radius:12px; object-fit:cover; border:1px solid var(--border) }
    .group{ border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff }
    .group h4{ margin:0 0 8px; font-size:14px }
    .opt{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px 0; border-top:1px dashed var(--border) }
    .opt:first-child{ border-top:none }
    .qtyRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; border-top:1px solid var(--border); padding-top:10px }
    .qtyBtns{ display:flex; align-items:center; gap:8px }
    .qtyBtns button{ width:32px; height:32px; border-radius:10px; border:1px solid var(--border); background:#fff; font-weight:700; cursor:pointer }
    .sheet footer{ padding:12px 14px; border-top:1px solid var(--border); display:flex; gap:10px }
    .sheet footer .btn{ flex:1 }

    @media (max-width:768px){
      .modal .sheet{
        left:0; right:0; top:auto; bottom:0; height:87vh; width:auto;
        border-left:none; border-top:1px solid var(--border);
        /* border-radius:16px 16px 0 0 */
      }
    }

    .clearCart-removeProduct {
        color: #ff5a60;
        background: none;
        border: none;
        padding: 10px 0;
    }

    /* ===== Botão 'Ver sacola' (absolute acima da section.duvidas) ===== */
    .bagBtn{
      position:fixed;
      right: 20px;
      /* transform:translateX(-50%); */
      bottom:64px;        /* fica logo acima da barra de dúvidas */
      z-index:1;
      display:none;
      padding:14px 18px;
      background: #ff0012;
      color:white;
      border:none;
      font-size: 14px;
      border-radius:999px;
      font-weight:700;
      box-shadow:var(--shadow);
      cursor:pointer;
      font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial;
    }
  </style>
</head>
<body>
  <div class="wrap" style="display:flex; align-items:center; justify-content:center">
    <div class="brand">
      <img src="/assets/logo.png" alt="Logo">
    </div>
  </div>
  <header>
    <nav class="nav" id="nav"></nav>
  </header>

  <main id="content"></main>

  <!-- Botão Ver Carrinho (acima da section.duvidas) -->
  <button id="bagBtn" class="bagBtn" aria-label="Ver carrinho" type="button">Ver carrinho (0)</button>

  <!-- MODAL DO PRODUTO -->
  <div class="modal" id="productModal" aria-hidden="true">
    <div class="backdrop" data-close-modal></div>
    <div class="sheet" role="dialog" aria-modal="true">
      <header>
        <strong>Personalize seu pedido</strong>
        <button class="btn btn-ghost" data-close-modal>Fechar</button>
      </header>
      <div class="body" id="pmBody"></div>
      <footer>
        <button class="btn btn-ghost" data-close-modal>Cancelar</button>
        <button class="btn btn-primary" id="pmAdd">Adicionar ao carrinho</button>
      </footer>
    </div>
  </div>

  <section class="duvidas">
    <p>Salvar cardápio no WhatsApp👉</p>
    <a href="https://wa.me/5512997498264?text=Ol%C3%A1%2C%20queria%20saber%20se%20a%20Jimmy%20entrega%20na%20minha%20regi%C3%A3o." target="_blank">Clique Aqui
      <!-- (ícone do WhatsApp mantido) -->
      <svg width="21" height="21" viewBox="0 0 21 21" fill="none" xmlns="http://www.w3.org/2000/svg"><mask id="mask0_1_48" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="2" y="2" width="17" height="17"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.71776 18.0167C2.70258 18.0713 2.70208 18.1289 2.7163 18.1838C2.73052 18.2387 2.75896 18.2888 2.79875 18.3292C2.83854 18.3695 2.88828 18.3987 2.94294 18.4137C2.9976 18.4287 3.05525 18.429 3.11007 18.4146L6.82126 17.4447C7.99873 18.0825 9.31661 18.4167 10.6557 18.417H10.6589C15.0782 18.417 18.6807 14.8355 18.6807 10.4324C18.6834 9.38235 18.4772 8.34229 18.0742 7.3727C17.6712 6.40311 17.0794 5.52334 16.3333 4.7846C15.5884 4.0398 14.7036 3.44962 13.7297 3.04801C12.7559 2.6464 11.7123 2.44128 10.6589 2.44446C6.23965 2.44446 2.63721 6.02596 2.63721 10.4283C2.63721 11.8292 3.00615 13.2051 3.7086 14.419L2.71776 18.0167ZM8.1166 6.60919C8.26401 6.61321 8.42754 6.62127 8.58301 6.96605C8.68612 7.19563 8.85932 7.61855 9.0011 7.96332C9.11146 8.23157 9.20168 8.4523 9.22423 8.49741C9.2766 8.60052 9.30801 8.71894 9.24035 8.8583L9.21779 8.90502C9.16301 9.0178 9.12435 9.09835 9.03251 9.20307L8.91732 9.34002C8.84885 9.4238 8.78037 9.50596 8.72237 9.56396C8.61846 9.66707 8.51132 9.77824 8.63054 9.98446C8.74976 10.1907 9.16865 10.869 9.78651 11.4159C10.2384 11.8235 10.7569 12.1505 11.3195 12.3826C11.3759 12.4068 11.4215 12.4272 11.4564 12.4438C11.6635 12.5469 11.7867 12.5308 11.9059 12.3923C12.026 12.2529 12.4239 11.7889 12.5641 11.5827C12.6994 11.3765 12.838 11.4087 13.0297 11.4796C13.2214 11.5513 14.2412 12.0515 14.4483 12.1538L14.5635 12.2102C14.7077 12.2787 14.8051 12.3262 14.847 12.3955C14.8986 12.4833 14.8986 12.8949 14.7278 13.3799C14.5522 13.8632 13.7072 14.3272 13.3245 14.3627L13.2158 14.3755C12.8645 14.4174 12.4199 14.4722 10.8345 13.8479C8.88026 13.0794 7.59057 11.1735 7.33037 10.7876L7.28768 10.7264L7.28365 10.7199C7.16443 10.5612 6.43862 9.59055 6.43862 8.58844C6.43862 7.62982 6.91148 7.13038 7.12657 6.90321L7.16443 6.86294C7.23405 6.78429 7.31911 6.72082 7.41432 6.67647C7.50953 6.63212 7.61285 6.60785 7.71785 6.60516C7.85721 6.60516 7.99737 6.60516 8.1166 6.60919Z" fill="white"/></mask><g mask="url(#mask0_1_48)"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.71776 18.0167C2.70258 18.0713 2.70208 18.1289 2.7163 18.1838C2.73052 18.2387 2.75896 18.2888 2.79875 18.3292C2.83854 18.3695 2.88828 18.3987 2.94294 18.4137C2.9976 18.4287 3.05525 18.429 3.11007 18.4146L6.82126 17.4447C7.99873 18.0825 9.31661 18.4167 10.6557 18.417H10.6589C15.0782 18.417 18.6807 14.8355 18.6807 10.4324C18.6834 9.38235 18.4772 8.34229 18.0742 7.3727C17.6712 6.40311 17.0794 5.52334 16.3333 4.7846C15.5884 4.0398 14.7036 3.44962 13.7297 3.04801C12.7559 2.6464 11.7123 2.44128 10.6589 2.44446C6.23965 2.44446 2.63721 6.02596 2.63721 10.4283C2.63721 11.8292 3.00615 13.2051 3.7086 14.419L2.71776 18.0167ZM8.1166 6.60919C8.26401 6.61321 8.42754 6.62127 8.58301 6.96605C8.68612 7.19563 8.85932 7.61855 9.0011 7.96332C9.11146 8.23157 9.20168 8.4523 9.22423 8.49741C9.2766 8.60052 9.30801 8.71894 9.24035 8.8583L9.21779 8.90502C9.16301 9.0178 9.12435 9.09835 9.03251 9.20307L8.91732 9.34002C8.84885 9.4238 8.78037 9.50596 8.72237 9.56396C8.61846 9.66707 8.51132 9.77824 8.63054 9.98446C8.74976 10.1907 9.16865 10.869 9.78651 11.4159C10.2384 11.8235 10.7569 12.1505 11.3195 12.3826C11.3759 12.4068 11.4215 12.4272 11.4564 12.4438C11.6635 12.5469 11.7867 12.5308 11.9059 12.3923C12.026 12.2529 12.4239 11.7889 12.5641 11.5827C12.6994 11.3765 12.838 11.4087 13.0297 11.4796C13.2214 11.5513 14.2412 12.0515 14.4483 12.1538L14.5635 12.2102C14.7077 12.2787 14.8051 12.3262 14.847 12.3955C14.8986 12.4833 14.8986 12.8949 14.7278 13.3799C14.5522 13.8632 13.7072 14.3272 13.3245 14.3627L13.2158 14.3755C12.8645 14.4174 12.4199 14.4722 10.8345 13.8479C8.88026 13.0794 7.59057 11.1735 7.33037 10.7876L7.28768 10.7264L7.28365 10.7199C7.16443 10.5612 6.43862 9.59055 6.43862 8.58844C6.43862 7.62982 6.91148 7.13038 7.12657 6.90321L7.16443 6.86294C7.23405 6.78429 7.31911 6.72082 7.41432 6.67647C7.50953 6.63212 7.61285 6.60785 7.71785 6.60516C7.85721 6.60516 7.99737 6.60516 8.1166 6.60919Z" fill="black" stroke="black" stroke-width="2.01389" stroke-linejoin="round"/></g></svg>
    </a>
  </section>

  <!-- CART -->
  <aside class="cart" id="cart" style="display: none;">
    <header>
      <div class="cartHead">
        <strong>Carrinho</strong>
        <button class="btn btn-ghost clearCart-removeProduct">Limpar carrinho</button>
      </div>
    </header>
    <div class="cartBody">
      <div id="cartLines" class="empty">Seu carrinho está vazio.</div>

      <div class="totals">
        <div style="display: none;"><span>Subtotal</span><strong id="subtotal" style="display: none;">R$ 0,00</strong></div>
        <div class="field" style="margin-top:4px; display:block;">
          <input type="number" id="delivery" inputmode="decimal" step="0.01" value="0.00" style="display: none;">
          <!-- <label>Cidade</label>
          <select>
            <option value="caraguatatuba">Caraguatatuba</option>
            <option value="sao_sebastiao">São Sebastião</option>
          </select> -->
        </div>
        <!-- <div class="field" style="display: block;">
          <label>Bairro</label>
          <select >
            <option value="PIX">Caraguatatuba</option>
            <option value="Cartão">São Sebastião</option>
          </select>
        </div> -->
        <div><span>Total</span><strong id="total">R$ 0,00</strong></div>
      </div>

      <div class="inputs" style="display: none;">
        <div class="field"><label>Nome</label><input id="name" placeholder="Ex.: Ricardo"/></div>
        <div class="field"><label>Endereço</label><input id="address" placeholder="Rua, número, bairro"/></div>
        <div class="field"><label>Forma de pagamento</label>
          <select id="payment">
            <option value="PIX">PIX</option>
            <option value="Cartão">Cartão</option>
            <option value="Dinheiro">Dinheiro</option>
          </select>
        </div>
        <div class="field"><label>Observações</label><textarea id="notes" rows="3" placeholder="Ex.: tirar cebola, ponto da carne..."></textarea></div>
      </div>

      <div class="actions" style="display: grid; gap:10px;">
        <button id="test" class="clearCart btn btn-ghost">Adicionar mais produtos</button>
        <button id="checkout" class="btn btn-primary">Finalizar no WhatsApp</button>
      </div>
    </div>
  </aside>

  <button class="cartToggle" id="cartToggle" style="display: none;">Abrir carrinho</button>

  <script>
    // ——————————— CONFIG BÁSICA ———————————
    const WHATSAPP_PHONE = "5512997498264"; // ex.: "55XXXXXXXXXXX"

    // Produtos
    const PRODUCTS = [
      {id:"b1", name:"Jimmy Clássico", desc:"Pão brioche, Burger 120g, queijo cheddar, alface, tomate, picles, maionese da casa.", price: 1990, img:"./assets/fotos/classico.png", cat:"Burgers"},
      {id:"b2", name:"Jimmy Bacon Salad", desc:"Pão brioche, Burger 120g, Bacon, queijo cheddar, alface, tomate, maionese da casa.", price: 2490, img:"./assets/fotos/bacon-salad.png", cat:"Burgers"},
      {id:"b3", name:"Jimmy Duplo Bacon", desc:"Pão brioche, 2 Burgers 80g, queijo cheddar, Bacon artesanal, maionese da casa.", price:  2780, img:"./assets/fotos/duplo.png", cat:"Burgers"},
      {id:"b4", name:"Jimmy Duplo Crispy", desc:"Pão brioche, 02 Burgers 80g, Cebola Crispy (cebola crocante), Bacon, alface, tomate maionese da casa.", price:  2980, img:"./assets/fotos/crispy.png", cat:"Burgers Especiais"},
      {id:"b5", name:"Jimmy Catupiry", desc:"Pão brioche, Burger 120g, Catupiry EmpanadoBacon, queijo cheddar, alface, tomate, mel e maionese da casa.", price:  3280, img:"./assets/fotos/catupiry.png", cat:"Burgers Especiais"},
      {id:"b6", name:"Jimmy Triplo Bacon", desc:"Pão brioche, 03 Burgers 80g, Bacon artesanal, queijo cheddar, cebola roxa defumada, picles e maionese da casa.", price:  3280, img:"./assets/fotos/triplo.png", cat:"Burgers Especiais"},
      {id:"c1", name:"Combo Clássico", desc:"1 Jimmy Clássico + Fritas + Refri", price: 2990, img:"./assets/fotos/combo-classico.png", cat:"Combos"},
      {id:"c2", name:"Combo Duplo Bacon", desc:"1 duplo bacon + fritas + refri ", price: 3700, img:"./assets/fotos/combo-duplo.png", cat:"Combos"},
      {"id":"a1","name":"Fritas Individual 120g","desc":"Porção individual","price":990,"img":"./assets/fotos/fritas.png","cat":"Petiscos Saborosos"},
      {"id":"a2","name":"Fritas Média 250g","desc":"Porção média","price":1980,"img":"./assets/fotos/fritas.png","cat":"Petiscos Saborosos"},
      {"id":"a3","name":"Coxinha de Frango (7 un)","desc":"Tamanho pequeno","price":990,"img":"./assets/fotos/coxinha.png","cat":"Petiscos Saborosos"},
      {"id":"a4","name":"Coxinha de Frango (15 un)","desc":"Tamanho pequeno","price":1980,"img":"./assets/fotos/coxinha.png","cat":"Petiscos Saborosos"},
      {"id":"d1","name":"Coca-Cola Lata","desc":"350ml","price":680,"img":"./assets/fotos/coca-lata.png","cat":"Bebidas"},
      {"id":"d2","name":"Guaraná Lata","desc":"350ml","price":680,"img":"./assets/fotos/guarana.png","cat":"Bebidas"},
      {"id":"d2","name":"Coca 200ml","desc":"200ml","price":400,"img":"./assets/fotos/coca_200.png","cat":"Bebidas"},
      {"id":"d2","name":"Guaraná 200ml","desc":"200ml","price":400,"img":"./assets/fotos/guarana_200.png","cat":"Bebidas"},
      {"id":"d4","name":"Coca-Cola Zero Lata","desc":"350ml","price":680,"img":"./assets/fotos/zero.png","cat":"Bebidas"},
      {"id":"d5","name":"Coca-Cola 600ml","desc":"Garrafa 600ml","price":890,"img":"./assets/fotos/coca-600ml.png","cat":"Bebidas"},
      {"id":"d5","name":"Guaraná 1L","desc":"Garrafa 1L","price":890,"img":"./assets/fotos/guarana_1l.png","cat":"Bebidas"},
      {"id":"d6","name":"Suco de Uva Integral","desc":"300ml","price":790,"img":"./assets/fotos/suco.png","cat":"Bebidas"},
      {"id":"d3","name":"Água Mineral","desc":"Com ou sem gás","price":400,"img":"./assets/fotos/agua.png","cat":"Bebidas"}
    ];

    // ——————————— HELPERS ———————————
    const fmtBRL = v => new Intl.NumberFormat('pt-BR', {style:'currency', currency:'BRL'}).format(v/100);
    const moneyToCents = (str) => {
      const n = parseFloat((str||"0").toString().replace(',', '.'));
      return Number.isFinite(n) ? Math.round(n*100) : 0;
    };
    const pointsFor = cents => Math.max(1, Math.round((cents/100)/3.5));
    const slug = s => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

    // ——— EXTRAS / ADICIONAIS (centavos) ———
    const DEFAULT_EXTRAS = [
      { id:"fritas",  name:"Fritas individual",         price:990 },
      { id:"refri",  name:"Refri lata 350ml",         price:680 },
      { id:"maionese",   name:"Maionese da Casa",    price:200 },
      { id:"refri_pequeno", name:"Refri pequeno 200ml",  price:400 },
    ];
    const EXTRAS_BY_CAT = {
      "Burgers": DEFAULT_EXTRAS,
      "Burgers Especiais": DEFAULT_EXTRAS,
      "Combos": [],
      "Petiscos Saborosos": [],
      "Bebidas": []
    };
    function getExtrasFor(product){ return EXTRAS_BY_CAT[product.cat] || []; }

    // ——————————— RENDER NAV + SECTIONS ———————————
    const categories = Array.from(new Set(PRODUCTS.map(p=>p.cat)));
    const nav = document.getElementById('nav');
    const content = document.getElementById('content');

    function renderNav(){
      nav.innerHTML = [...categories].map(cat => {
        const href = cat==='Todos' ? '#topo' : `#cat-${slug(cat)}`;
        return `<a href="${href}" data-cat="${cat}">${cat}</a>`;
      }).join('');
      // Ativo dinâmico
      nav.addEventListener('click', (e)=>{
        if(e.target.tagName==='A'){
          [...nav.querySelectorAll('a')].forEach(a=>a.classList.remove('active'));
          e.target.classList.add('active');
        }
      });
    }

    function renderSections(){
      let html = ``;
      for(const cat of categories){
        const list = PRODUCTS.filter(p=>p.cat===cat).map(cardHTML).join('');
        html += `<section class="section" id="cat-${slug(cat)}"><h2>${cat}</h2><div class="grid">${list}</div></section>`
      }
      content.innerHTML = html;
      content.addEventListener('click', onCardClick);
    }

    function cardHTML(p){
      return `
      <article class="card" data-id="${p.id}">
        <img loading="lazy" class="thumb" src="${p.img}" alt="${p.name}">
        <div class="info">
          <h3 class="title">${p.name}</h3>
          <p class="desc">${p.desc}</p>
          <div class="priceRow">
            <span class="price">${fmtBRL(p.price)}</span>
            <button class="btn btn-primary" data-add="${p.id}">Adicionar</button>
          </div>
        </div>
      </article>`;
    }

    // Clique no botão OU em qualquer área do card abre o modal do produto
    function onCardClick(e){
      const addBtn = e.target.closest('[data-add]');
      const card = e.target.closest('.card');
      if(!addBtn && !card) return;
      const id = addBtn ? addBtn.getAttribute('data-add') : (card && card.getAttribute('data-id'));
      if(!id) return;
      openProductModal(id);
    }

    // ——————————— CART STATE ———————————
    // chave composta id|extra1,extra2 para suportar itens iguais com extras diferentes
    const cart = new Map();     // key -> { qty }
    const CART_META = new Map(); // key -> { id, extras }

    function makeKey(id, extras){
      const xs = (extras||[]).slice().sort().join(',');
      return `${id}|${xs}`;
    }

    function addToCart(payload, delta){
      if(typeof payload === 'string') payload = {id: payload, qty: 1, extras: []};
      const {id, extras = [], qty = 1} = payload;
      const key = makeKey(id, extras);
      const item = cart.get(key) || { qty:0 };
      item.qty += qty + (delta||0);
      if(item.qty <= 0){
        cart.delete(key); CART_META.delete(key);
      } else {
        cart.set(key, item); CART_META.set(key, { id, extras });
      }
      renderCart();
    }

    function removeFromCart(key){ cart.delete(key); CART_META.delete(key); renderCart(); }

    function lines(){
      return [...cart.entries()].map(([key, {qty}])=>{
        const meta = CART_META.get(key) || {}; const id = meta.id || key.split('|')[0];
        const extras = meta.extras || [];
        const p = PRODUCTS.find(x=>x.id===id) || {};
        const extraObjs = getExtrasFor(p).filter(x=>extras.includes(x.id));
        const extrasTotal = extraObjs.reduce((s,x)=>s+x.price,0);
        const unit = (p.price||0) + extrasTotal;
        const total = unit * qty;
        const extrasText = extraObjs.length ? ` + ${extraObjs.map(x=>x.name).join(', ')}` : '';
        return { key, id, name: p.name, price: unit, basePrice: p.price||0, extrasText, qty, total };
      });
    }

    function calcTotals(){
      const subtotal = lines().reduce((acc,l)=>acc+l.total,0);
      const delivery = moneyToCents(document.getElementById('delivery').value);
      return { subtotal, delivery, total: subtotal + delivery };
    }

    // ——————————— RENDER CART ———————————
    const cartLinesEl = document.getElementById('cartLines');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');

    function renderCart(){
      const L = lines();
      if(!L.length){
        cartLinesEl.className='empty';
        cartLinesEl.innerHTML = 'Seu carrinho está vazio.';
      } else {
        cartLinesEl.className='';
        cartLinesEl.innerHTML = L.map(l=>`
          <div class="line" data-line="${l.key}">
            <div style="display:flex; gap:10px; align-items:center; min-width:0">
              <span class="chip">${l.qty}x</span>
              <div style="display:grid">
                <strong class="lineTitle">${l.name}</strong>
                <span class="tiny">${fmtBRL(l.basePrice)} un.${l.extrasText ? ` — <em>${l.extrasText}</em>` : ''}</span>
              </div>
            </div>
            <div style="display:flex; gap:6px; align-items:center">
              <button class="iconBtn" data-dec="${l.key}">−</button>
              <button class="iconBtn" data-inc="${l.key}">+</button>
              <strong>${fmtBRL(l.total)}</strong>
              <button class="iconBtn" title="Remover" data-del="${l.key}">×</button>
            </div>
          </div>
        `).join('');
      }
      const {subtotal, total} = calcTotals();
      subtotalEl.textContent = fmtBRL(subtotal);
      totalEl.textContent = fmtBRL(total);
      updateCartBadge();
    }

    cartLinesEl.addEventListener('click', (e)=>{
      const t = e.target;
      if(t.matches('[data-inc]')){
        const key = t.getAttribute('data-inc');
        const meta = CART_META.get(key); addToCart({id:meta.id, extras:meta.extras, qty:1});
      }
      if(t.matches('[data-dec]')){
        const key = t.getAttribute('data-dec');
        const cur = cart.get(key); if(!cur) return; cur.qty = Math.max(0, cur.qty-1);
        if(cur.qty===0){ cart.delete(key); CART_META.delete(key); }
        renderCart();
      }
      if(t.matches('[data-del]')) removeFromCart(t.getAttribute('data-del'));
    });

    document.getElementById('delivery').addEventListener('input', renderCart);
    document.querySelectorAll('.clearCart').forEach(btn => {
      btn.addEventListener('click', ()=>{
        const cartEl = document.getElementById('cart');
        cartEl.style.display = 'none';
      });
    });

    document.querySelectorAll('.clearCart-removeProduct').forEach(btn => {
      btn.addEventListener('click', ()=>{
        cart.clear(); CART_META.clear(); renderCart();
        updateCartBadge();
        setTimeout(()=>{
          const cartEl = document.getElementById('cart');
          cartEl.style.display = 'none';
        }, 1000);
      });
    });

    // ——————————— CHECKOUT ———————————
    document.getElementById('checkout').addEventListener('click', ()=>{
      const L = lines();
      if(!L.length){ alert('Adicione itens ao carrinho.'); return; }
      const {subtotal, delivery, total} = calcTotals();
      const name = (document.getElementById('name').value||'').trim();
      const address = (document.getElementById('address').value||'').trim();
      const payment = document.getElementById('payment').value;
      const notes = (document.getElementById('notes').value||'').trim();

      const rows = L.map(l=>`• ${l.qty}× ${l.name}${l.extrasText || ''} — ${fmtBRL(l.price)} (= ${fmtBRL(l.total)})`).join('\n');

      const linesMsg = [
        `*Olá, Gostaria de fazer um pedido:*`,
        name ? `Cliente: ${name}`: '',
        address ? `Endereço: ${address}`: '',
        '',
        '*Itens*',
        rows,
        '',
        `Taxa de entrega: ${fmtBRL(delivery)}`,
        `*Subtotal: ${fmtBRL(total)}*`,
        // payment ? `Pagamento: ${payment}` : '',
        notes ? `Obs.: ${notes}` : '',
      ].filter(Boolean).join('\n');

      const urlBase = WHATSAPP_PHONE ? `https://wa.me/${WHATSAPP_PHONE}` : 'https://wa.me/';
      const url = `${urlBase}?text=${encodeURIComponent(linesMsg)}`;
      window.open(url, '_blank');
    });

    // ——————————— MODAL LOGIC ———————————
    const modal = document.getElementById('productModal');
    const pmBody = document.getElementById('pmBody');
    const pmAdd = document.getElementById('pmAdd');
    modal.addEventListener('click', (e)=>{ if(e.target.hasAttribute('data-close-modal')) closeProductModal(); });

    let CURRENT_MODAL = null; // { id, qty, selectedExtras:Set }

    function openProductModal(id){
      const p = PRODUCTS.find(x=>x.id===id);
      const extras = getExtrasFor(p);
      CURRENT_MODAL = { id, qty: 1, selectedExtras: new Set() };
      const opts = extras.map(opt=>`
        <label class="opt">
          <div style="display:flex; gap:8px; align-items:center">
            <input type="checkbox" data-extra-id="${opt.id}" />
            <span>${opt.name}</span>
          </div>
          <span class="tiny">+ ${fmtBRL(opt.price)}</span>
        </label>
      `).join('');

      pmBody.innerHTML = `
        <div class="prodHead">
          <img src="${p.img}" alt="${p.name}">
          <div>
            <h3>${p.name}</h3>
            <p class="desc" style="margin:4px 0 6px">${p.desc}</p>
            <strong id="pmPrice">${fmtBRL(p.price)}</strong>
          </div>
        </div>
        <div class="group">
          <h4>Adicionais (opcional)</h4>
          ${extras.length ? opts : '<span class="tiny">Sem adicionais para este item.</span>'}
        </div>
        <div class="qtyRow">
          <span>Quantidade</span>
          <div class="qtyBtns">
            <button type="button" id="pmDec">−</button>
            <strong id="pmQty">1</strong>
            <button type="button" id="pmInc">+</button>
          </div>
        </div>
      `;

      pmBody.querySelectorAll('[data-extra-id]').forEach(el=>{
        el.addEventListener('change', ()=>{
          const exId = el.getAttribute('data-extra-id');
          if(el.checked) CURRENT_MODAL.selectedExtras.add(exId);
          else CURRENT_MODAL.selectedExtras.delete(exId);
          updatePmTotal();
        });
      });
      pmBody.querySelector('#pmDec').addEventListener('click', ()=>{
        CURRENT_MODAL.qty = Math.max(1, CURRENT_MODAL.qty-1);
        const q=document.getElementById('pmQty'); if(q) q.textContent = CURRENT_MODAL.qty;
        updatePmTotal();
      });
      pmBody.querySelector('#pmInc').addEventListener('click', ()=>{
        CURRENT_MODAL.qty++;
        const q=document.getElementById('pmQty'); if(q) q.textContent = CURRENT_MODAL.qty;
        updatePmTotal();
      });

      pmAdd.onclick = () => {
        const extrasChosen = Array.from(CURRENT_MODAL.selectedExtras);
        addToCart({ id, qty: CURRENT_MODAL.qty, extras: extrasChosen });
        closeProductModal();
      };

      updatePmTotal();
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden','false');
    }

    function closeProductModal(){
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden','true');
      CURRENT_MODAL = null;
    }

    function updatePmTotal(){
      if(!CURRENT_MODAL) return;
      const p = PRODUCTS.find(x=>x.id===CURRENT_MODAL.id);
      const extras = getExtrasFor(p).filter(x=>CURRENT_MODAL.selectedExtras.has(x.id));
      const extrasTotal = extras.reduce((s,x)=>s+x.price,0);
      const totalUnit = p.price + extrasTotal;
      const total = totalUnit * CURRENT_MODAL.qty;
      const priceEl = document.getElementById('pmPrice'); if(priceEl) priceEl.textContent = fmtBRL(total);
      const qEl = document.getElementById('pmQty'); if(qEl) qEl.textContent = CURRENT_MODAL.qty;
    }

    // ——————————— MOBILE TOGGLE & SACOLA ———————————
    const toggleBtn = document.getElementById('cartToggle');
    const cartEl = document.getElementById('cart');

    // >>> Substitui a função updateCartBadge para controlar o botão 'Ver sacola'
    function updateCartBadge(){
      const btn = document.getElementById('bagBtn');
      if(!btn) return;
      // soma todas as quantidades do carrinho
      const qty = [...cart.values()].reduce((sum, it)=> sum + (it.qty||0), 0);
      if(qty > 0){
        btn.textContent = `Ver carrinho (${qty})`;
        btn.style.display = 'inline-flex';
      } else {
        btn.style.display = 'none';
      }
    }

    // Clique no botão "Ver sacola" abre o carrinho
    document.getElementById('bagBtn').addEventListener('click', ()=>{
      cartEl.style.display = 'block';
    });

    toggleBtn.addEventListener('click', ()=>{
      toggleBtn.style.opacity = toggleBtn.style.opacity === "0.6" ? "1" : "0.6";
      cartEl.style.display = cartEl.style.display === 'none' ? 'block' : 'none';
    });
    const mq = window.matchMedia('(max-width:1024px)');
    const setCartVisible = () => { cartEl.style.display = mq.matches ? 'none' : 'block'; };
    mq.addEventListener('change', setCartVisible);

    // Init
    renderNav();
    renderSections();
    renderCart();
    setCartVisible();
  </script>
</body>
</html>
