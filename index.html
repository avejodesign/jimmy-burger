<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Card√°pio | Jimmy Burger</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      /* PALETA CLARA */
      --bg:#ffffff;
      --card:#ffffff;
      --muted:#5b6475;          /* cinza de texto secund√°rio */
      --text:#111317;           /* texto principal (quase preto) */
      --brand:#fff04d;          /* amarelo mais suave */
      --brand-600:#F2C200;      /* hover do amarelo */
      --danger:#ff5a60;
      --border:#e5e7eb;         /* borda clara */
      --radius:16px;
      --shadow:0 10px 30px rgba(0,0,0,.06);
    }

    *{box-sizing:border-box}
    body{
      margin:0; font-family:"Poppins",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,"Helvetica Neue",Arial;
      background:var(--bg);
      color:var(--text);
    }

    /* HEADER */
    header{
      position:sticky; top:0; z-index:40;
      backdrop-filter:saturate(120%) blur(8px);
      background:rgba(0, 0, 0, 1);
      border-bottom:1px solid var(--border);
      border-top:1px solid var(--border);
    }

    #cat-burgers { margin: 0; }

    .wrap{ margin:0 auto; padding: 10px 20px; background: black;}
    .brand{ display:flex; align-items:center; gap:12px; justify-content: center; background: black; }
    .brand img{ width:50%;}
    .brand h1{margin:0; font-size:20px; letter-spacing:.2px}
    .tag{font-size:12px; color:var(--muted); background:#f6f7f9; padding:4px 8px; border:1px solid var(--border); border-radius:999px}

    /* NAV CATEGORIES */
    .nav{ margin-left: 20px; display:flex; gap:6px; overflow-x:auto; padding: 8px 20px 8px; scroll-snap-type:x mandatory; -webkit-overflow-scrolling:touch }
    .nav a{ scroll-snap-align:start; white-space:nowrap; text-decoration:none; color:#000; border:1px solid #3c3c3c; padding:4px 14px; border-radius:999px; background:#ffffff; font-size:14px; opacity:.95 }
    .nav a.active{ background:var(--brand); border-color:transparent; color:#111; font-weight:600 }

    main{ max-width:1200px; margin:0 auto; padding:20px; padding-bottom:140px; background:var(--bg) }

    section.duvidas { background:rgb(0, 0, 0, 1); position: fixed; left: 0; bottom: 0; padding:2px 10px; text-align:center; width: 100%; color: white; display: flex; justify-content: center; }
    section.duvidas p { font-size: 12px; margin-right: 4px; }
    section.duvidas a { background: #00E01A; color: black; padding: 2px 8px; display: flex; align-items: center; justify-content: center; border-radius: 999px; text-decoration: none; font-size: 14px; font-weight: 600; transform: scale(0.86); }

    .section{ margin:26px 0 8px }
    .section:nth-child(1){ margin-top:0 }
    .section h2{ font-size:18px; margin:0 0 14px; font-weight:600; background: #FFF83E; padding: 6px 14px; border-radius: 8px;}

    .grid{ display:grid; gap:16px; grid-template-columns:repeat(1, minmax(0,1fr)) }
    @media (min-width:560px){ .grid{ grid-template-columns:repeat(2, minmax(0,1fr)) } }
    @media (min-width:920px){ .grid{ grid-template-columns:repeat(3, minmax(0,1fr)) } }

    .card{ background:var(--card); border:1px solid var(--border); border-radius:var(--radius); overflow:hidden; box-shadow:var(--shadow); display:flex; flex-direction:column; justify-content: space-between; cursor:pointer; }
    /* .box-thumb{width: fit-content; overflow: hidden; } */
    .thumb{ aspect-ratio:16/10; width:100%; object-fit:cover; overflow: hidden; display: block;}
    .info{ padding:14px 14px 12px; display:flex; flex-direction:column; gap:10px; width: 100%;}
    .title{ font-size:16px; margin:0; letter-spacing:.2px; color:var(--text) }
    .desc{ font-size:13px; color:var(--muted); margin:0 }
    .priceRow{ display:flex; align-items:center; justify-content:space-between }
    .price{ font-weight:600 }

    .btn{ appearance:none; cursor:pointer; border:1px solid transparent; border-radius:12px; padding:10px 12px; font-weight:600; font-size:14px; }
    .btn-primary{ background:var(--brand); color:#111; border-color:transparent }
    .btn-primary:hover{ background:var(--brand-600) }
    .btn-ghost{ background:#fff; color:#111; border-color:var(--border) }
    .btn-ghost:hover{ background:#f8f9fb }

    /* CART */
    .cart{ position:fixed; right:20px; top:80px; width:340px; max-height:70vh; overflow:auto; z-index:50; background:#ffffff; border:1px solid var(--border); border-radius:18px; box-shadow:var(--shadow); color:var(--text); }
    .cart header{ position:sticky; top:0; background:rgba(255,255,255,.9); backdrop-filter:saturate(120%) blur(6px); border-bottom:1px solid var(--border) }
    .cartHead{ display:flex; align-items:center; justify-content:space-between; padding:14px 14px 6px }
    .cartBody{ padding:8px 14px 14px; display:flex; flex-direction:column; gap:10px }
    .line{ display:flex; align-items:center; gap:10px; justify-content:space-between; border:1px dashed var(--border); border-radius:12px; padding:10px; background:#fff }
    .lineTitle{ font-size:13px }
    .qty{ display:flex; align-items:center; gap:8px }
    .chip{ border:1px solid var(--border); background:#f9fafb; padding:4px 8px; border-radius:999px; font-size:12px; color:#374151 }
    .iconBtn{ width:28px; height:28px; border-radius:8px; border:1px solid var(--border); background:#ffffff; color:#111; cursor:pointer; font-weight:700 }
    .iconBtn:hover{ background:#f6f7f9 }
    .totals{font-size:14px; display:grid; gap:6px }
    .totals div{ display:flex; align-items:center; justify-content:space-between }
    .inputs{ display:grid; gap:8px; margin-top:6px }
    .field{ display:grid; gap:6px }
    .field label{ font-size:12px; color:var(--muted) }
    .field input, .field textarea, .field select{ width:100%; background:#fff; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:10px; font-family:inherit; font-size:14px }

    .actions{ display:grid; gap:8px; margin-top:8px }
    .tiny{ font-size:12px; color:var(--muted) }

    /* MOBILE CART */
    .cartToggle{ position:fixed; left:50%; transform:translateX(-50%); bottom:16px; z-index:60; padding:20px 24px; background:var(--brand); color:#111; border:none; border-radius:999px; font-weight:700; box-shadow:var(--shadow); display:none }
    @media (max-width:1024px){ .cart{ left:16px; right:16px; bottom:20px; top:10px; width:auto; max-height: 100vh; height: calc(100vh - 40px); } .cartToggle{ display:inline-flex } }

    /* Smooth scroll */
    html{ scroll-behavior:smooth }
    .empty{ text-align:center; color:var(--muted); border:1px dashed var(--border); padding:16px; border-radius:12px }

    /* Lista mobile com thumb √† direita */
    .points{display:none; align-items:center; gap:6px; font-size:12px; color:var(--brand)}
    .points .gift{width:16px; height:16px; fill:var(--brand)}
    @media (max-width:560px){
      .card{ flex-direction:row-reverse; align-items:center }
      .thumb{ width:140px; height:140px; aspect-ratio:1/1; border-radius:12px;  object-fit:cover }
      .info{ padding:12px; gap:6px }
      .title{ font-size:14px; text-transform:uppercase; letter-spacing:.2px; }
      .desc{ font-size:11px; text-transform:uppercase; color:var(--muted); line-height:1.25; display: -webkit-box; -webkit-line-clamp: 3 !important; -webkit-box-orient: vertical; overflow: hidden;}
      .priceRow{ margin-top:2px }
      .points{ display:flex }
    }

    /* MODAL */
    .modal{ position:fixed; inset:0; display:none; z-index:80; }
    .modal.is-open{ display:block }
    .modal .backdrop{ position:absolute; inset:0; background:rgba(0,0,0,.5); }
    .modal .sheet{ position:absolute; right:0; top:0; bottom:0; width:560px; max-width:100%; background:#fff; color:#111; border-left:1px solid var(--border); box-shadow:var(--shadow); display:flex; flex-direction:column }
    .sheet header{ display:flex; align-items:center; justify-content:space-between; padding:12px 14px; border-bottom:1px solid var(--border) }
    .sheet h3{ margin:0; font-size:18px;}
    .sheet header strong { color: white; }
    .sheet .body{ padding:12px 14px; overflow:auto; display:grid; gap:12px }
    .sheet .prodHead{ display:flex; gap:12px; align-items:center }
    .sheet .prodHead img{ width:84px; height:84px; border-radius:12px; object-fit:cover; border:1px solid var(--border) }
    .group{ border:1px solid var(--border); border-radius:12px; padding:10px; background:#fff }
    .group h4{ margin:0 0 8px; font-size:14px }
    .opt{ display:flex; align-items:center; justify-content:space-between; gap:12px; padding:8px 0; border-top:1px dashed var(--border) }
    .opt:first-child{ border-top:none }
    .qtyRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; border-top:1px solid var(--border); padding-top:10px }
    .qtyBtns{ display:flex; align-items:center; gap:8px }
    .qtyBtns button{ width:32px; height:32px; border-radius:10px; border:1px solid var(--border); background:#fff; font-weight:700; cursor:pointer }
    .sheet footer{ padding:12px 14px; border-top:1px solid var(--border); display:flex; gap:10px }
    .sheet footer .btn{ flex:1 }

    .clearCart-removeProduct { color: #ff5a60; background: none; border: none; padding: 10px 0; }

    /* Bot√£o 'Ver sacola' */
    .bagBtn{ position:fixed; right: 20px; bottom:64px; z-index:1; display:none; padding:14px 18px; background:#ff0012; color:white; border:none; font-size:14px; border-radius:999px; font-weight:700; box-shadow:var(--shadow); cursor:pointer; font-family:"Poppins", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial; }
  </style>
</head>
<body>
  <div class="wrap" style="display:flex; align-items:center; justify-content:center">
    <div class="brand">
      <img src="/assets/logo.png" alt="Logo">
    </div>
  </div>
  <header>
    <nav class="nav" id="nav"></nav>
  </header>

  <main id="content"></main>

  <!-- Bot√£o Ver Carrinho (acima da section.duvidas) -->
  <button id="bagBtn" class="bagBtn" aria-label="Ver carrinho" type="button">Ver carrinho (0)</button>

  <!-- MODAL DO PRODUTO -->
  <div class="modal" id="productModal" aria-hidden="true">
    <div class="backdrop" data-close-modal></div>
    <div class="sheet" role="dialog" aria-modal="true">
      <header>
        <strong>Personalize seu pedido</strong>
        <button class="btn btn-ghost" data-close-modal>Fechar</button>
      </header>
      <div class="body" id="pmBody"></div>
      <footer>
        <button class="btn btn-ghost" data-close-modal>Cancelar</button>
        <button class="btn btn-primary" id="pmAdd">Adicionar ao carrinho</button>
      </footer>
    </div>
  </div>

  <section class="duvidas">
    <p>üòÅ O Jimmy entrega no meu bairro?</p>
    <a href="https://wa.me/5512997498264?text=Ol%C3%A1%2C%20gostaria%20de%20saber%20se%20a%20Jimmy%20entrega%20na%20minha%20regi%C3%A3o." target="_blank">Whatsapp</a>
  </section>

  <!-- CART -->
  <aside class="cart" id="cart" style="display: none;">
    <header>
      <div class="cartHead">
        <strong>Carrinho</strong>
        <button class="btn btn-ghost clearCart-removeProduct">Limpar carrinho</button>
      </div>
    </header>
    <div class="cartBody">
      <div id="cartLines" class="empty">Seu carrinho est√° vazio.</div>

      <div class="totals">
        <div style="display: none;"><span>Subtotal</span><strong id="subtotal" style="display: none;">R$ 0,00</strong></div>
        <div class="field" style="margin-top:4px; display:block;">
          <input type="number" id="delivery" inputmode="decimal" step="0.01" value="0.00" style="display: none;">
        </div>
        <div><span>Total</span><strong id="total">R$ 0,00</strong></div>
      </div>

      <div class="inputs" style="display: none;">
        <div class="field"><label>Nome</label><input id="name" placeholder="Ex.: Ricardo"/></div>
        <div class="field"><label>Endere√ßo</label><input id="address" placeholder="Rua, n√∫mero, bairro"/></div>
        <div class="field"><label>Forma de pagamento</label>
          <select id="payment">
            <option value="PIX">PIX</option>
            <option value="Cart√£o">Cart√£o</option>
            <option value="Dinheiro">Dinheiro</option>
          </select>
        </div>
        <div class="field"><label>Observa√ß√µes</label><textarea id="notes" rows="3" placeholder="Ex.: tirar cebola, ponto da carne..."></textarea></div>
      </div>

      <div class="actions" style="display: grid; gap:10px;">
        <button id="test" class="clearCart btn btn-ghost">Adicionar mais produtos</button>
        <button id="checkout" class="btn btn-primary">Finalizar no WhatsApp</button>
      </div>
    </div>
  </aside>

  <button class="cartToggle" id="cartToggle" style="display: none;">Abrir carrinho</button>

  <script>
    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CONFIG B√ÅSICA ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const WHATSAPP_PHONE = "5512997498264"; // ex.: "55XXXXXXXXXXX"

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî PRODUTOS (com variantes opcionais) ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // Regras:
    // - Se o produto tiver variants: cada option possui price ABSOLUTO do item unit√°rio
    // - Se n√£o tiver variants: usa product.price normalmente
    const PRODUCTS = [
      // Burgers COM variantes (exemplos prontos para editar):
      { id:"b1", name:"Jimmy Cl√°ssico", desc:"P√£o  brioche,  Burger  120g,  queijo cheddar, alface, tomate, picles, cebola roxa defumada e maionese da casa.", img:"./assets/fotos/classico.png", cat:"BURGERS",price:1990
      },
      { id:"b2", name:"Jimmy Bacon Salad", desc:"P√£o Brioche, Burger 120g, bacon, cheddar, alface, tomate, cebola roxa defumada e maionese da casa.", img:"./assets/fotos/bacon-salad.png", cat:"BURGERS", price:2490
      },
      { id:"b3", name:"Jimmy Duplo Bacon", desc:"P√£o Brioche, 2x burger 80g, cheddar, Bacon artesanal, cebola roxa defumada e maionese da casa", img:"./assets/fotos/duplo.png", cat:"BURGERS", 
        variants:[{ id:"carne", title:"Quantidade de hamb√∫rguer", type:"single", required:true,
          options:[ {id:"2x80", label:"2x 80g", price:2790}, {id:"2x120", label:"2x 120g", price:3390} ] }]
      },
      { id:"b7", name:"Jimmy Duplo Bacon Salad", desc:"P√£o Brioche, 2x burger 80g, bacon, cheddar, alface, tomate, cebola roxa e maionese da casa", img:"./assets/fotos/jimmy-duplo-salad.png", cat:"BURGERS",
        variants:[{ id:"carne", title:"Quantidade de hamb√∫rguer", type:"single", required:true,
          options:[ {id:"2x80", label:"2x 80g", price:2990}, {id:"2x120", label:"2x 120g", price:3490} ] }]
      },
      { id:"b4", name:"Jimmy Duplo Crispy", desc:"P√£o Brioche, 2x burger 80g, cebola crispy, bacon, alface, tomate e maionese da casa", img:"./assets/fotos/jimmy-duplo-crispy.png", cat:"BURGERS",
        variants:[{ id:"carne", title:"Quantidade de hamb√∫rguer", type:"single", required:true,
          options:[ {id:"2x90", label:"2x 80g", price:3190}, {id:"2x120", label:"2x 120g", price:3590} ] }]
      },
      { id:"b5", name:"Jimmy Catupiry", desc:"P√£o Brioche, 1x burger 120g, Catupiry empanado, bacon, cheddar, alface, tomate, mel e maionese da casa", img:"./assets/fotos/jimmy-duplo-crispy-1.png", cat:"BURGERS",
        variants:[{ id:"carne", title:"Quantidade de hamb√∫rguer", type:"single", required:true,
          options:[ {id:"1x120", label:"1x 120g", price:3490}, {id:"1x180", label:"2x 120g", price:3990} ] }]
      },
      {id:"b10", name:"Jimmy Triplo Bacon", desc:"P√£o brioche, 3x burger 80g, Bacon artesanal, queijo cheddar, cebola roxa defumada, picles e maionese da casa.", img:"./assets/fotos/triplo.png", cat:"BURGERS",
        variants:[{ id:"carne", title:"Quantidade de hamb√∫rguer", type:"single", required:true,
          options:[ {id:"3x90", label:"3x 80g", price:3490}, {id:"3x120", label:"3x 120g", price:3990} ] }]
      },

      // { id:"b7", name:"Jimmy Burger", desc:"P√£o brioche, 1 Burger 180g, queijo cheddar e maionese da casa.", img:"./assets/fotos/jimmy-burger.png", cat:"Burgers Gourmet", price:2490},

      // { id:"b8", name:"Dr. Bacon (Goodman)", desc:"P√£o brioche, 1 Burger 180g, queijo cheddar, bacon defumado cebola grelhada e maionese da casa.", img:"./assets/fotos/dr-bacon.png", cat:"Burgers Gourmet", price:2990
      // },
      // { id:"b9", name:"Jimmy da Reca√≠da", desc:"P√£o brioche, 2 Burger 180g, queijo cheddar, bacon defumado alface, tomate, cebola grelhada picles e maionese da casa.", img:"./assets/fotos/jimmy-recaida.png", cat:"Burgers Gourmet", price:3890
      // },

      // Combos (sem variantes, mant√©m price como antes)
      {id:"c1", name:"Combo Cl√°ssico", desc:"1 Jimmy Cl√°ssico + Fritas + Refri", price:2990, img:"./assets/fotos/combo-classico.png", cat:"COMBOS"},
      {id:"c2", name:"Combo Duplo Bacon", desc:"1 duplo bacon + fritas + refri", price:3780, img:"./assets/fotos/combo-duplo.png", cat:"COMBOS"},
      {id:"c4", name:"Combo Casal", desc:"2 Cl√°ssicos + fritas + Guaran√° 1L", price:4990, img:"./assets/fotos/casal.png", cat:"COMBOS"},
      {id:"c5", name:"Combo Fam√≠lia", desc:"4 Cl√°ssicos + Guaran√° 1L", price:7990, img:"./assets/fotos/familia.png", cat:"COMBOS"},

      // Petiscos
      {id:"a1", name:"Fritas Individual 150g", desc:"Por√ß√£o individual", price:990, img:"./assets/fotos/fritas.png", cat:"FRITAS"},
      {id:"a2", name:"Fritas M√©dia 300g", desc:"Por√ß√£o m√©dia", price:1990, img:"./assets/fotos/fritas.png", cat:"FRITAS"},
      // {id:"a4", name:"Fritas M√©dia com Cheddar e Bacon 300g", desc:"Por√ß√£o m√©dia", price:2990, img:"./assets/fotos/fritas-cheddar.png", cat:"FRITAS"},

      {id:"e1", name:"Leite em p√≥ e leite condensado", desc:"Tamanho de 300ml", price:1480, img:"./assets/fotos/acai.png", cat:"A√áAI 300ML"},
      {id:"e2", name:"Leite condensado e morango", desc:"Tamanho de 300ml", price:1480, img:"./assets/fotos/acai.png", cat:"A√áAI 300ML"},
      {id:"e3", name:"Leite em p√≥ e morango", desc:"Tamanho de 300ml", price:1480, img:"./assets/fotos/acai.png", cat:"A√áAI 300ML"},
      {id:"e4", name:"Leite condensado, leite em p√≥ e morango", desc:"Tamanho de 300ml", price:1580, img:"./assets/fotos/acai.png", cat:"A√áAI 300ML"},

      // Bebidas
      {id:"d1", name:"Coca-Cola Lata", desc:"350ml", price:680, img:"./assets/fotos/coca-lata.png", cat:"BEBIDAS"},
      {id:"d2", name:"Guaran√° Lata", desc:"350ml", price:680, img:"./assets/fotos/guarana.png", cat:"BEBIDAS"},
      // {id:"d7", name:"Coca 200ml", desc:"200ml", price:400, img:"./assets/fotos/coca_200.png", cat:"BEBIDAS"},
      // {id:"d8", name:"Guaran√° 200ml", desc:"200ml", price:400, img:"./assets/fotos/guarana_200.png", cat:"BEBIDAS"},
      {id:"d4", name:"Coca-Cola Zero Lata", desc:"350ml", price:680, img:"./assets/fotos/zero.png", cat:"BEBIDAS"},
      {id:"d5", name:"Coca-Cola 600ml", desc:"Garrafa 600ml", price:890, img:"./assets/fotos/coca-600ml.png", cat:"BEBIDAS"},
      {id:"d6", name:"Guaran√° 1L", desc:"Garrafa 1L", price:890, img:"./assets/fotos/guarana_1l.png", cat:"BEBIDAS"},
      // {id:"d9", name:"Suco de Uva Integral", desc:"300ml", price:790, img:"./assets/fotos/suco.png", cat:"BEBIDAS"},
      {id:"d3", name:"√Ågua Mineral", desc:"Com ou sem g√°s", price:400, img:"./assets/fotos/agua.png", cat:"BEBIDAS"}
    ];

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî HELPERS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const fmtBRL = v => new Intl.NumberFormat('pt-BR', {style:'currency', currency:'BRL'}).format(v/100);
    const moneyToCents = (str) => { const n = parseFloat((str||"0").toString().replace(',', '.')); return Number.isFinite(n) ? Math.round(n*100) : 0; };
    const pointsFor = cents => Math.max(1, Math.round((cents/100)/3.5));
    const slug = s => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-z0-9]+/g,'-').replace(/(^-|-$)/g,'');

    // ‚Äî‚Äî EXTRAS ‚Äî‚Äî
    const DEFAULT_EXTRAS = [
      // { id:"hamb120",  name:"Hamb√∫rguer extra 120g", price:990 },
      { id:"fritas",   name:"Fritas individual",     price:990 },
      { id:"refri",    name:"Refri lata 350ml",      price:680 },
      { id:"maionese", name:"Maionese da Casa",      price:200 },
      { id:"refri200", name:"Refri pequeno 200ml",   price:400 },
    ];
    const EXTRAS_BY_CAT = {
      "BURGERS": DEFAULT_EXTRAS,
      "COMBOS": [],
      "FRITAS": [],
      "Bebidas": []
    };
    function getExtrasFor(product){ return EXTRAS_BY_CAT[product.cat] || []; }

    // ‚Äî‚Äî VARIANTES ‚Äî‚Äî
    function hasVariants(p){ return Array.isArray(p.variants) && p.variants.length > 0; }
    function getVariantGroups(p){ return hasVariants(p) ? p.variants : []; }
    function variantUnitPrice(product, selectedVariantsMap){
      if(!hasVariants(product)) return product.price || 0;
      let base = 0;
      for(const grp of product.variants){
        const chosenId = selectedVariantsMap?.get(grp.id);
        const opt = grp.options.find(o=>o.id===chosenId) || grp.options[0];
        base += opt.price || 0;
      }
      return base;
    }
    function variantLabelSummary(product, selectedVariantsMap){
      if(!hasVariants(product)) return '';
      const parts = [];
      for(const grp of product.variants){
        const chosenId = selectedVariantsMap?.get(grp.id);
        const opt = grp.options.find(o=>o.id===chosenId) || grp.options[0];
        parts.push(opt.label);
      }
      return parts.join(' ¬∑ ');
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî RENDER NAV + SECTIONS ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const categories = Array.from(new Set(PRODUCTS.map(p=>p.cat)));
    const nav = document.getElementById('nav');
    const content = document.getElementById('content');

    function renderNav(){
      nav.innerHTML = [...categories].map(cat => {
        const href = cat==='Todos' ? '#topo' : `#cat-${slug(cat)}`;
        return `<a href="${href}" data-cat="${cat}">${cat}</a>`;
      }).join('');
      nav.addEventListener('click', (e)=>{
        if(e.target.tagName==='A'){
          [...nav.querySelectorAll('a')].forEach(a=>a.classList.remove('active'));
          e.target.classList.add('active');
        }
      });
    }

    function renderSections(){
      let html = ``;
      for(const cat of categories){
        const list = PRODUCTS.filter(p=>p.cat===cat).map(cardHTML).join('');
        html += `<section class="section" id="cat-${slug(cat)}"><h2>${cat}</h2><div class="grid">${list}</div></section>`
      }
      content.innerHTML = html;
      content.addEventListener('click', onCardClick);
    }

    function priceForCard(p){
      // se tiver variantes, mostra o menor pre√ßo como "a partir de"
      if(hasVariants(p)){
        const min = p.variants.reduce((acc, grp)=>{
          const m = Math.min(...grp.options.map(o=>o.price||0));
          return acc + (Number.isFinite(m)?m:0);
        }, 0);
        return `${fmtBRL(min)}`;
      }
      return fmtBRL(p.price);
    }

    function cardHTML(p){
      return `
      <article class="card" data-id="${p.id}">
        <div class="box-thumb">
          <img loading="lazy" class="thumb" src="${p.img}" alt="${p.name}">
        </div>
        <div class="info">
          <h3 class="title">${p.name}</h3>
          <p class="desc">${p.desc}</p>
          <div class="priceRow">
            <span class="price">${priceForCard(p)}</span>
            <button class="btn btn-primary" data-add="${p.id}">Adicionar</button>
          </div>
        </div>
      </article>`;
    }

    // Clique no bot√£o OU no card abre o modal do produto
    function onCardClick(e){
      const addBtn = e.target.closest('[data-add]');
      const card = e.target.closest('.card');
      if(!addBtn && !card) return;
      const id = addBtn ? addBtn.getAttribute('data-add') : (card && card.getAttribute('data-id'));
      if(!id) return;
      openProductModal(id);
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CART STATE ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    // chave composta id|v:variants|x:extras
    const cart = new Map();     // key -> { qty }
    const CART_META = new Map(); // key -> { id, extras, variantsMap }

    function makeKey(id, extras, selectedVariantsMap){
      const xs = (extras||[]).slice().sort().join(',');
      const vs = selectedVariantsMap ? [...selectedVariantsMap.entries()].map(([g,o])=>`${g}=${o}`).sort().join(',') : '';
      return `${id}|v:${vs}|x:${xs}`;
    }

    function addToCart(payload, delta){
      if(typeof payload === 'string') payload = {id: payload, qty: 1, extras: [], variantsMap: null};
      const {id, extras = [], qty = 1, variantsMap = null} = payload;
      const key = makeKey(id, extras, variantsMap);
      const item = cart.get(key) || { qty:0 };
      item.qty += qty + (delta||0);
      if(item.qty <= 0){
        cart.delete(key); CART_META.delete(key);
      } else {
        cart.set(key, item); CART_META.set(key, { id, extras, variantsMap });
      }
      renderCart();
    }

    function removeFromCart(key){ cart.delete(key); CART_META.delete(key); renderCart(); }

    function lines(){
      return [...cart.entries()].map(([key, {qty}])=>{
        const meta = CART_META.get(key) || {}; const id = meta.id || key.split('|')[0];
        const extras = meta.extras || [];
        const variantsMap = meta.variantsMap || null;
        const p = PRODUCTS.find(x=>x.id===id) || {};
        const extraObjs = getExtrasFor(p).filter(x=>extras.includes(x.id));
        const extrasTotal = extraObjs.reduce((s,x)=>s+x.price,0);
        const baseUnit = variantUnitPrice(p, variantsMap);
        const unit = (baseUnit||0) + extrasTotal;
        const total = unit * qty;
        const variantText = variantLabelSummary(p, variantsMap);
        const extrasText = extraObjs.length ? ` + ${extraObjs.map(x=>x.name).join(', ')}` : '';
        return { key, id, name: p.name, price: unit, basePrice: baseUnit||0, variantText, extrasText, qty, total };
      });
    }

    function calcTotals(){
      const subtotal = lines().reduce((acc,l)=>acc+l.total,0);
      const delivery = moneyToCents(document.getElementById('delivery').value);
      return { subtotal, delivery, total: subtotal + delivery };
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî RENDER CART ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const cartLinesEl = document.getElementById('cartLines');
    const subtotalEl = document.getElementById('subtotal');
    const totalEl = document.getElementById('total');

    function renderCart(){
      const L = lines();
      if(!L.length){
        cartLinesEl.className='empty';
        cartLinesEl.innerHTML = 'Seu carrinho est√° vazio.';
      } else {
        cartLinesEl.className='';
        cartLinesEl.innerHTML = L.map(l=>`
          <div class="line" data-line="${l.key}">
            <div style="display:flex; gap:10px; align-items:center; min-width:0">
              <span class="chip">${l.qty}x</span>
              <div style="display:grid">
                <strong class="lineTitle">${l.name}</strong>
                <span class="tiny">
                  ${l.variantText ? `${l.variantText} ‚Äî ` : ''}${fmtBRL(l.basePrice)} un.
                  ${l.extrasText ? ` ‚Äî <em>${l.extrasText}</em>` : ''}
                </span>
              </div>
            </div>
            <div style="display:flex; gap:6px; align-items:center">
              <button class="iconBtn" data-inc="${l.key}">+</button>
              <button class="iconBtn" data-dec="${l.key}">‚àí</button>
              <strong>${fmtBRL(l.total)}</strong>
              <button class="iconBtn" title="Remover" data-del="${l.key}">√ó</button>
            </div>
          </div>
        `).join('');
      }
      const {subtotal, total} = calcTotals();
      subtotalEl.textContent = fmtBRL(subtotal);
      totalEl.textContent = fmtBRL(total);
      updateCartBadge();
    }

    cartLinesEl.addEventListener('click', (e)=>{
      const t = e.target;
      if(t.matches('[data-inc]')){
        const key = t.getAttribute('data-inc');
        const meta = CART_META.get(key); addToCart({id:meta.id, extras:meta.extras, qty:1, variantsMap:meta.variantsMap});
      }
      if(t.matches('[data-dec]')){
        const key = t.getAttribute('data-dec');
        const cur = cart.get(key); if(!cur) return; cur.qty = Math.max(0, cur.qty-1);
        if(cur.qty===0){ cart.delete(key); CART_META.delete(key); }
        renderCart();
      }
      if(t.matches('[data-del]')) removeFromCart(t.getAttribute('data-del'));
    });

    document.getElementById('delivery').addEventListener('input', renderCart);
    document.querySelectorAll('.clearCart').forEach(btn => {
      btn.addEventListener('click', ()=>{ document.getElementById('cart').style.display = 'none'; });
    });

    document.querySelectorAll('.clearCart-removeProduct').forEach(btn => {
      btn.addEventListener('click', ()=>{
        cart.clear(); CART_META.clear(); renderCart(); updateCartBadge();
        setTimeout(()=>{ document.getElementById('cart').style.display = 'none'; }, 1000);
      });
    });

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî CHECKOUT ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    document.getElementById('checkout').addEventListener('click', ()=>{
      const L = lines();
      if(!L.length){ alert('Adicione itens ao carrinho.'); return; }
      const {total} = calcTotals();
      const name = (document.getElementById('name').value||'').trim();
      const address = (document.getElementById('address').value||'').trim();
      const payment = document.getElementById('payment').value;
      const notes = (document.getElementById('notes').value||'').trim();

      const rows = L.map(l=>`‚Ä¢ ${l.qty}√ó ${l.name}${l.variantText ? ` (${l.variantText})` : ''}${l.extrasText || ''} ‚Äî ${fmtBRL(l.price)} (= ${fmtBRL(l.total)})`).join('\n');

      const linesMsg = [
        `*Ol√°, Gostaria de fazer um pedido:*`,
        name ? `Cliente: ${name}`: '',
        address ? `Endere√ßo: ${address}`: '',
        '',
        '*Itens*',
        rows,
        '',
        `Taxa de entrega: A combinar`,
        `*Subtotal: ${fmtBRL(total)}*`,
        payment ? `Pagamento: ${payment}` : '',
        notes ? `Obs.: ${notes}` : '',
      ].filter(Boolean).join('\n');

      const urlBase = WHATSAPP_PHONE ? `https://wa.me/${WHATSAPP_PHONE}` : 'https://wa.me/';
      const url = `${urlBase}?text=${encodeURIComponent(linesMsg)}`;
      window.open(url, '_blank');
    });

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî MODAL LOGIC ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const modal = document.getElementById('productModal');
    const pmBody = document.getElementById('pmBody');
    const pmAdd = document.getElementById('pmAdd');
    modal.addEventListener('click', (e)=>{ if(e.target.hasAttribute('data-close-modal')) closeProductModal(); });

    let CURRENT_MODAL = null; // { id, qty, selectedExtras:Set, selectedVariants: Map }

    function openProductModal(id){
      const p = PRODUCTS.find(x=>x.id===id);
      const extras = getExtrasFor(p);

      // estado inicial das variantes
      const selectedVariants = new Map();
      for(const grp of getVariantGroups(p)){
        const first = grp.options[0];
        selectedVariants.set(grp.id, first.id);
      }

      CURRENT_MODAL = { id, qty: 1, selectedExtras: new Set(), selectedVariants };

      // grupos de variantes
      const variantGroupsHTML = hasVariants(p) ? getVariantGroups(p).map(grp=>{
        const opts = grp.options.map(opt=>`
          <label class="opt">
            <div style="display:flex; gap:8px; align-items:center">
              <input type="radio" name="var_${grp.id}" data-variant="${grp.id}" value="${opt.id}" ${opt.id===CURRENT_MODAL.selectedVariants.get(grp.id)?'checked':''}/>
              <span>${opt.label}</span>
            </div>
            <span class="tiny">${fmtBRL(opt.price)}</span>
          </label>
        `).join('');
        return `
          <div class="group">
            <h4>${grp.title}</h4>
            ${opts}
          </div>
        `;
      }).join('') : '';

      // extras
      const extrasHTML = extras.length
        ? extras.map(opt=>`
            <label class="opt">
              <div style="display:flex; gap:8px; align-items:center">
                <input type="checkbox" data-extra-id="${opt.id}" />
                <span>${opt.name}</span>
              </div>
              <span class="tiny">+ ${fmtBRL(opt.price)}</span>
            </label>
          `).join('')
        : '<span class="tiny">Sem adicionais para este item.</span>';

      pmBody.innerHTML = `
        <div class="prodHead">
          <img src="${p.img}" alt="${p.name}">
          <div>
            <h3>${p.name}</h3>
            <p class="desc" style="margin:4px 0 6px">${p.desc}</p>
            <strong id="pmPrice">${fmtBRL(variantUnitPrice(p, CURRENT_MODAL.selectedVariants))}</strong>
          </div>
        </div>
        ${variantGroupsHTML}
        <div class="group">
          <h4>Adicionais (opcional)</h4>
          ${extrasHTML}
        </div>
        <div class="qtyRow">
          <span>Quantidade</span>
          <div class="qtyBtns">
            <button type="button" id="pmDec">‚àí</button>
            <strong id="pmQty">1</strong>
            <button type="button" id="pmInc">+</button>
          </div>
        </div>
      `;

      // listeners variantes
      pmBody.querySelectorAll('input[type="radio"][data-variant]').forEach(el=>{
        el.addEventListener('change', ()=>{
          const gid = el.getAttribute('data-variant');
          const val = el.value;
          CURRENT_MODAL.selectedVariants.set(gid, val);
          updatePmTotal();
        });
      });

      // listeners extras
      pmBody.querySelectorAll('[data-extra-id]').forEach(el=>{
        el.addEventListener('change', ()=>{
          const exId = el.getAttribute('data-extra-id');
          if(el.checked) CURRENT_MODAL.selectedExtras.add(exId);
          else CURRENT_MODAL.selectedExtras.delete(exId);
          updatePmTotal();
        });
      });

      // qty
      pmBody.querySelector('#pmDec').addEventListener('click', ()=>{
        CURRENT_MODAL.qty = Math.max(1, CURRENT_MODAL.qty-1);
        const q=document.getElementById('pmQty'); if(q) q.textContent = CURRENT_MODAL.qty;
        updatePmTotal();
      });
      pmBody.querySelector('#pmInc').addEventListener('click', ()=>{
        CURRENT_MODAL.qty++;
        const q=document.getElementById('pmQty'); if(q) q.textContent = CURRENT_MODAL.qty;
        updatePmTotal();
      });

      pmAdd.onclick = () => {
        const extrasChosen = Array.from(CURRENT_MODAL.selectedExtras);
        addToCart({ id, qty: CURRENT_MODAL.qty, extras: extrasChosen, variantsMap: CURRENT_MODAL.selectedVariants });
        closeProductModal();
      };

      updatePmTotal();
      modal.classList.add('is-open');
      modal.setAttribute('aria-hidden','false');
    }

    function closeProductModal(){
      modal.classList.remove('is-open');
      modal.setAttribute('aria-hidden','true');
      CURRENT_MODAL = null;
    }

    function updatePmTotal(){
      if(!CURRENT_MODAL) return;
      const p = PRODUCTS.find(x=>x.id===CURRENT_MODAL.id);
      const extras = getExtrasFor(p).filter(x=>CURRENT_MODAL.selectedExtras.has(x.id));
      const extrasTotal = extras.reduce((s,x)=>s+x.price,0);
      const baseUnit = variantUnitPrice(p, CURRENT_MODAL.selectedVariants);
      const totalUnit = baseUnit + extrasTotal;
      const total = totalUnit * CURRENT_MODAL.qty;
      const priceEl = document.getElementById('pmPrice'); if(priceEl) priceEl.textContent = fmtBRL(total);
      const qEl = document.getElementById('pmQty'); if(qEl) qEl.textContent = CURRENT_MODAL.qty;
    }

    // ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî MOBILE TOGGLE & SACOLA ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
    const toggleBtn = document.getElementById('cartToggle');
    const cartEl = document.getElementById('cart');

    function updateCartBadge(){
      const btn = document.getElementById('bagBtn');
      if(!btn) return;
      const qty = [...cart.values()].reduce((sum, it)=> sum + (it.qty||0), 0);
      if(qty > 0){ btn.textContent = `Ver carrinho (${qty})`; btn.style.display = 'inline-flex'; }
      else { btn.style.display = 'none'; }
    }

    document.getElementById('bagBtn').addEventListener('click', ()=>{ cartEl.style.display = 'block'; });
    toggleBtn.addEventListener('click', ()=>{ toggleBtn.style.opacity = toggleBtn.style.opacity === "0.6" ? "1" : "0.6"; cartEl.style.display = cartEl.style.display === 'none' ? 'block' : 'none'; });
    const mq = window.matchMedia('(max-width:1024px)');
    const setCartVisible = () => { cartEl.style.display = mq.matches ? 'none' : 'block'; };
    mq.addEventListener('change', setCartVisible);

    // Init
    renderNav();
    renderSections();
    renderCart();
    setCartVisible();
  </script>
</body>
</html>
